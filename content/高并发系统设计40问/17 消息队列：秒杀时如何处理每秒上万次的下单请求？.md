# 消息队列：秒杀时如何处理每秒上万次的下单请求？

> [!question] 高并发系统设计的三个目标?
>
> - 性能
> - 可用性
> - 可扩展

**遇到的大部分场景都是读多写少，尤其是在一个系统的初级阶段**。

高并发写请求的场景（秒杀抢购就是最典型的场景）

> [!question] 读请求过高，那么应对的措施有哪些呢？

## 1 我所理解的消息队列

**对消息队列的看法：**

把消息队列看作**暂时存储数据的一个容器**，认为消息队列是一个**平衡低速系统和高速系统**处理任务时间差的工具。

## 2 削去秒杀场景下的峰值写流量

> [!question] 如何用消息队列解决秒杀场景下的问题呢？

**秒杀场景**：秒杀场景下，高并发的写请求并不是持续的，也不是经常发生的，而只有在秒杀活动开始后的几秒或者十几秒时间内才会存在。

**思路**：

将秒杀请求暂存在消息队列中，然后业务服务器会响应用户 `秒杀结果正在计算中`，释放了系统资源之后再处理其它用户的请求。

消息队列在秒杀系统中最主要的作用：**削峰填谷**

![[17 消息队列：秒杀时如何处理每秒上万次的下单请求？_image_1.png]]

## 3 通过异步处理简化秒杀请求中的业务流程

实现**异步处理**来简化秒杀请求中的业务流程，提升系统的性能。

![[17 消息队列：秒杀时如何处理每秒上万次的下单请求？_image_2.png]]

## 4 解耦实现秒杀系统模块之间松耦合

![[17 消息队列：秒杀时如何处理每秒上万次的下单请求？_image_3.png]]

**异步处理、解耦合和削峰填谷**是消息队列在秒杀系统设计中起到的主要作用。

- **异步处理**：可以简化业务流程中的步骤，提升系统性能
- **削峰填谷**：可以削去到达秒杀系统的峰值流量，让业务逻辑的处理更加缓和
- **解耦合**：可以将秒杀系统和数据系统解耦开，这样两个系统的任何变更都不会影响到另一个系统

如果你的系统想要提升写入性能，实现系统的低耦合，想要抵挡高并发的写流量，那么你就可以考虑使用消息队列来完成。

引入了消息队列的同时也会引入了新的问题，需要新的方案来解决，这就是系统设计的挑战，也是系统设计独有的魅力，而我们也会在这些挑战中不断提升技术能力和系统设计能力。

## 小结

- **削峰填谷**是消息队列最主要的作用，但是会造成请求处理的延迟。
- **异步处理**是提升系统性能的神器，但是你需要分清同步流程和异步流程的边界，同时消息存在着丢失的风险，我们需要考虑如何确保消息一定到达。
- **解耦合**可以提升你的整体系统的鲁棒性。

引入了消息队列的同时也会引入了新的问题，需要新的方案来解决，这就是系统设计的挑战，也是系统设计独有的魅力，而我们也会在这些挑战中不断提升技术能力和系统设计能力。
