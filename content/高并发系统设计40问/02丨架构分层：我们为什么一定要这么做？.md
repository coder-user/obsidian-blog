# 02丨架构分层：我们为什么一定要这么做？

> [!question]
>
> 1. 如何对架构进行分层？
> 2. 架构分层和高并发架构设计又有什么关系呢？

## 1 什么是分层架构

软件架构分层在软件工程中是一种常见的设计方式，它是将整体系统拆分成 N 个层次，每个层次有独立的职责，多个层次协同提供完整的功能。

常见的分层架构：

1. MVC：Model（模型），View（视图）和 Controller（控制器）
2. 整体架构分为：表现层、逻辑层和数据访问层。

分层的示例：

- OSI 网络模型，它把整个网络分了七层，自下而上分别是物理层、数据链路层、网络层、传输层、会话层、表示层和应用层
- TCP/IP 协议，它把网络简化成了四层，即链路层、网络层、传输层和应用层

## 2 分层有什么好处

1. 分层的设计可以简化系统设计，让不同的人专注做某一层次的事情
2. 分层之后可以做到很高的复用
3. 分层架构可以让我们更容易做横向扩展

横向扩展是高并发系统设计的常用方法之一，既然分层的架构可以为横向扩展提供便捷，那么支撑高并发的系统一定是分层的系统。

## 3 如何来做系统分层

![[800-ob/000-attachments/02丨架构分层：我们为什么一定要这么做？_image_1.png]]

- **终端显示层**：各端模板渲染并执行显示的层
- **开放接口层**：将 Service 层方法封装成开放接口，同时进行网关安全控制和流量控制等。
- **Web 层**：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。
- **Service 层**：业务逻辑层。
- **Manager 层**：通用业务处理层。
  - 将原先 Service 层的一些通用能力下沉到这一层，比如与缓存和存储交互策略，中间件的接入；
  - 在这一层封装对第三方接口的调用，比如调用支付服务，调用审核服务等。
- **DAO 层**：数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。
- **外部接口或第三方平台**：包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。

分层架构需要考虑的另一个因素，是**层次之间一定是相邻层互相依赖**，数据的流转也只能在相邻的两层之间流转。

## 4 分层架构的不足

1. 增加了代码的复杂度：修改一个功能，可能需要修改多个层次的代码
2. 每个层次独立部署，层次间通过网络来交互，那么多层的架构在性能上会有损耗。（**多一跳**）

> [!important]   熟知的一些软件设计原则都在分层架构中有所体现

1. **单一职责原则**: 规定每个类只有单一的功能。在这里可以引申为每一层拥有单一职责，且层与层之间边界清晰
2. **迪米特法则**: 原意是一个对象应当对其它对象有尽可能少的了解。在分层架构的体现是数据的交互不能跨层，只能在相邻层之间进行；
3. **开闭原则**: 要求软件对扩展开放，对修改关闭。它的含义其实就是将抽象层和实现层分离，抽象层是对实现层共有特征的归纳总结，不可以修改，但是具体的实现是可以无限扩展，随意替换的。

掌握这些设计思想会自然而然地明白分层架构设计的妙处，同时也能帮助我们做出更好的设计方案。
